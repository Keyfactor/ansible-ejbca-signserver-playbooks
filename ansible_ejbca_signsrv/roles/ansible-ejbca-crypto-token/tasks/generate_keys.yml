---
# tasks file for roles/ansible-ejbca-crypto-token

- name: Generate key if it does not exist for {% if key_item.0.crypto_token_name is defined %}{{ key_item.0.crypto_token_name }}{% else %}{{ key_item.0.caname }}{% endif %} - {{ key_item.1.key_label }}:{{ key_item.1.key_size }}
  ejbca_cryptotoken:
    cmd: generatekey
    token: "{% if key_item.0.crypto_token_name is defined %}{{ key_item.0.crypto_token_name }}{% else %}{{ key_item.0.caname }}{% endif %}"
    key_alias: "{{ key_item.1.key_label }}"
    key_spec: "{{ key_item.1.key_size }}"
    path: "{{ ejbca_home }}"
  become: true
  become_user: "{{ ejbca_user }}"
  register: key_generation

#- debug: msg={{ key_generation }}