---

- name: Create EJBCA database indexes
  command: >
    {{ ejbca_home }}/../clientToolBox/ejbcaClientToolBox.sh jdbc 
    --url jdbc:{{ appsrv_datasources[0].database_connection_type }}://{{ appsrv_datasources[0].host }}:{{ appsrv_datasources[0].port }}{% if appsrv_datasources[0].database_connection_type == "mariadb" %}/{{ appsrv_datasources[0].database }}{% elif appsrv_datasources[0].database_connection_type == "sqlserver" %};DatabaseName={{ appsrv_datasources[0].database }}{{ appsrv_datasources[0].connection_parameters }}{% endif %} 
    --username {{ appsrv_datasources[0].user }} 
    --password {{ appsrv_datasources[0].password }}
    {{ item.index }}
  loop: "{{ ejbca_database_indexes }}" 
  no_log: true
  become_user: "{{ ejbca_user }}"
  become_method: sudo
  register: applying_database_indexes
  ignore_errors: yes

- name: Log the Index errors 
  debug:
    #msg: "Some part of applying database indexes failed with message: {{ applying_database_indexes.stderr }}"
    var: applying_database_indexes
    verbosity: 4
  #when: applying_database_indexes.stderr